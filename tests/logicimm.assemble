* Stand-alone test for NI, NIY, OI, OIY, XI, XIY                        00010000
* This file was put into the public domain 2015-10-05                   00020000
* by John P. Hartmann.  You can use it for anything you like,           00030000
* as long as this notice remains.                                       00040000
 punch ':test logicImmediate'                                           00050000
 punch ':btst z'                                                        00060000
ni start 0                                                              00070000
 org ni+x'1a0'                                                          00080000
 dc x'0000000180000000'                                                 00090000
 dc ad(go_ni)                                                           00100000
 org ni+x'1d0'                                                          00110000
 dc x'0002000180000000'                                                 00120000
 dc ad(x'deaddead') Program new PSW                                     00130000
 org ni+x'200'                                                          00140000
 using ni,0                                                             00150000
go_ni ds 0d                                                             00160000
 sr 0,0 Store one dword                                                 00170000
 stfle facilities                                                       00180000
 mvc faclist,facilities Save for display                                00190000
 la 0,8                                                                 00200000
 la 1,1                                                                 00210000
 la 2,nibytes                                                           00220000
loop ds 0h                                                              00230000
 ex 1,inst_ni                                                           00240000
 ex 1,inst_niy                                                          00250000
 ex 1,inst_oi                                                           00260000
 ex 1,inst_oiy                                                          00270000
 ex 1,inst_xi                                                           00280000
 ex 1,inst_xiy                                                          00290000
 la 2,1(,2)                                                             00300000
 sll 1,1                                                                00310000
 bct 0,loop                                                             00320000
 nc facilities,fmask  Select bit 52                                     00330000
 lpswe stop                                                             00340000
 drop 0                                                                 00350000
 using nibytes,2                                                        00360000
inst_ni ni nibytes,0                                                    00370000
inst_niy niy niybytes,0                                                 00380000
inst_oi oi oibytes,0                                                    00390000
inst_oiy oiy oiybytes,0                                                 00400000
inst_xi xi xibytes,0                                                    00410000
inst_xiy xiy xiybytes,0                                                 00420000
stop ds 0d                                                              00430000
 dc x'0002000180000000'                                                 00440000
 dc ad(0)                                                               00450000
 org ni+x'800' To specific address                                      00460000
nibytes dc 8x'ff'                                                       00470000
oibytes dc 8x'00'                                                       00480000
xibytes dc 8x'ff'                                                       00490000
 org ni+x'880' To specific address                                      00500000
facilities ds d                                                         00510000
faclist ds d Original                                                   00520000
fmask dc (52/8)x'00',x'08',x'00'                                        00530000
 org ni+x'2000' To be sure long displacement is used                    00540000
niybytes dc 8x'ff'                                                      00550000
oiybytes dc 8x'00'                                                      00560000
xiybytes dc 8x'ff'                                                      00570000
 punch ':etst 1'                                                        00580000
 punch '* *Compare'                                                     00590000
 punch '* r 800.8'                                                      00600000
 punch '* *Want               01020408 10204080'                        00610000
 punch '* *Compare'                                                     00620000
 punch '* r 808.8'                                                      00630000
 punch '* *Want               01020408 10204080'                        00640000
 punch '* *Compare'                                                     00650000
 punch '* r 810.8'                                                      00660000
 punch '* *Want               FEFDFBF7 EFDFBF7F'                        00670000
 punch '* *Compare'                                                     00680000
 punch '* r 2000.8'                                                     00690000
 punch '* *Want               01020408 10204080'                        00700000
 punch '* *Compare'                                                     00710000
 punch '* r 2008.8'                                                     00720000
 punch '* *Want               01020408 10204080'                        00730000
 punch '* *Compare'                                                     00740000
 punch '* r 2010.8'                                                     00750000
 PUNCH '* *Want               FEFDFBF7 EFDFBF7F'                        00760000
 punch '* *Compare'                                                     00770000
 punch '* r 880.8'                                                      00780000
 PUNCH '* *Want "Facilities list bit 52"   00000000 00000800'           00790000
 punch '* * First doubleword of facilities list'                        00800000
 punch '* r 888.8'                                                      00810000
 punch '* *Done'                                                        00820000
 end                                                                    00830000
