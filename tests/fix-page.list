ASMA Ver. 0.2.0  fix-page.asm: Test the Fix Page E502 Assist                                        05 Oct 2020 07:42:20  Page     1

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                               2 *
                                               3 ***********************************************************************
                                               4 *
                                               5 *Testcase fix-page
                                               6 *  A test case for "Simplified Execution Path" of the Fix
                                               7 *  Page E502 Assist instruction.
                                               8 *
                                               9 ***********************************************************************
                                              10 *
                                              11 *                        fix-page.asm
                                              12 *
                                              13 * Created and placed into the public domain 05 OCT 2020 by Bob Polmanter.
                                              14 *
                                              15 * The Fix Page E502 Assist instruction is tested against the definition
                                              16 * of the Simplified Execution Path as described in the System/370
                                              17 * Assists for MVS, publication GA22-7079-1.
                                              18 *
                                              19 * Test data is assembled into this program, and some test data is
                                              20 * generated by this program. The test script (fix-page.tst) that runs
                                              21 * verifies the resulting status of registers and path taken
                                              22 * through Hercules R commands.
                                              23 *
                                              24 *
                                              25 * Tests performed with Fix Page E502:
                                              26 *
                                              27 * 1.  That GR14 contains the address of the next sequential instruction
                                              28 *       following the E502 instruction.
                                              29 * 2.  That GR15 contains the contents of the fullword field MPLPFAL.
                                              30 * 3.  That the PSW next instruction address is loaded with the fullword
                                              31 *     field MPLPFAL and that execution resumed at that location.
                                              32 *
                                              33 * NOTE: the MPLP is a control block normally maintained by some versions of
                                              34 *       the S/370 MVS operating system in support of the various Assists. The
                                              35 *       base address of the MPLP is defined by the second operand of the
                                              36 *       E502 instruction.  The word MPLPFAL is at offset 0x34 into the MPLP,
                                              37 *       as described in GA22-7079-1.
                                              38 *
                                              39 ***********************************************************************
                                              40 *
                                              41 *
                            000000  000747    42 FPA001   START 0
                            000000  000001    43 STRTLABL EQU   *
                            000000  000001    44 R0       EQU   0
                            000001  000001    45 R1       EQU   1
                            000002  000001    46 R2       EQU   2
                            000003  000001    47 R3       EQU   3
                            000004  000001    48 R4       EQU   4
                            000005  000001    49 R5       EQU   5
                            000006  000001    50 R6       EQU   6
                            000007  000001    51 R7       EQU   7
                            000008  000001    52 R8       EQU   8
                            000009  000001    53 R9       EQU   9
ASMA Ver. 0.2.0  fix-page.asm: Test the Fix Page E502 Assist                                        05 Oct 2020 07:42:20  Page     2

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                            00000A  000001    54 R10      EQU   10
                            00000B  000001    55 R11      EQU   11
                            00000C  000001    56 R12      EQU   12
                            00000D  000001    57 R13      EQU   13
                            00000E  000001    58 R14      EQU   14
                            00000F  000001    59 R15      EQU   15
                                              60 *
                                              61 *
000000                      000000            62          USING *,R0
                                              63 *
                                              64 * Selected S/370 low core layout
                                              65 *
000000                      000000  00008C    66          ORG   STRTLABL+X'8C'      Program check interrution code
00008C  00000000                              67 PGMINTC  DS    F
                                              68 *
                            000028  000001    69 PGMOPSW  EQU   STRTLABL+X'28'      Program check old PSW
                                              70 *
000090                      000090  000000    71          ORG   STRTLABL+X'00'      Restart PSW
000000  000C0000 00000200                     72          DC    X'000C0000',A(START)
                                              73 *
000008                      000008  000068    74          ORG   STRTLABL+X'68'      Program check new PSW
000068  00020000 0000DEAD                     75 PGMNPSW  DC    X'00020000',X'0000DEAD' Abnormal end
                                              76 *
000070                      000070  0000A4    77          ORG   STRTLABL+X'A4'      Address of MPLP assist control block
0000A4  00000700                              78 AMPLP    DC    A(MPLP)
                                              79
ASMA Ver. 0.2.0  fix-page.asm: Test the Fix Page E502 Assist                                        05 Oct 2020 07:42:20  Page     3

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                              81 ***********************************************************************
                                              82 *
                                              83 *  Main program.
                                              84 *
0000A8                      0000A8  000200    85          ORG   STRTLABL+X'200'
000200                                        86 START    DS    0H
                                              87 *
                                              88 *
                                              89 **********
                                              90 * TEST   * Execute Fix Page on simplified path return
                                              91 **********
                                              92 *
000200  41E0 0001                   000001    93          LA    R14,1                   Ensure R14 different than Assist result
000204  41F0 0001                   000001    94          LA    R15,1                   Ensure R15 different than Assist result
000208  90EF 0300                   000300    95          STM   R14,R15,RESULTS         Initialize results area
                                              96 *
00020C  9812 073C                   00073C    97          LM    R1,R2,PGSTART           -> starting,ending page addresses
000210  5800 0744                   000744    98          L     R0,PGRADD               -> address within page to be fixed
000214  E5020000 00A4                         99          DC    X'E502',AL2(0),S(AMPLP) Fix Page; operand 1 not used
                                             100 *
                            00021A  000001   101 FAIL     EQU   *
00021A  47F0 0222                   000222   102          B     EOJ                     If here, test has failed
                                             103 *
                            00021E  000001   104 SUCCESS  EQU   *
00021E  90EF 0300                   000300   105          STM   R14,R15,RESULTS         If E502 success, show R14-R15 results
                                             106 *
                            000222  000001   107 EOJ      EQU   *
000222  8200 0228                   000228   108          LPSW  DWAITPSW                EOJ, load disabled wait PSW
                                             109 *
000228                                       110          DS    0D                      Ensure correct alignment for psw
000228  000A0000 00000000                    111 DWAITPSW DC    X'000A000000000000'     Test end - disabled wait
                                             112 *
                                             113 *
000230                      000230  000300   114          ORG   STRTLABL+X'300'
000300  00000000                             115 RESULTS  DC    X'00000000'             R14 value (should be A(FAIL) )
000304  00000000                             116          DC    X'00000000'             R15 value (should be A(SUCCESS) )
                                             117 *
                                             118 *
000308                      000308  000700   119          ORG   STRTLABL+X'700'
                                             120 *
                                             121 * The MPLP area below defines only the relevant part of the MPLP assist control block; in this
                                             122 * case, the location at MPLP+X'34' (MPLPFAL) needs to contain the address of where the assist
                                             123 * should begin execution at the completion of the X'E502' instruction.
                                             124 *
000700  00000000                             125 MPLP     DC    A(0)                    Relevant MPLP block definition
000704  00000000                             126          DC    A(0)                    +4
000708  00000000                             127          DC    A(0)                    +8
00070C  00000000                             128          DC    A(0)                    +C
000710  00000000                             129          DC    A(0)                    +10
000714  00000000                             130          DC    A(0)                    +14
000718  00000000                             131          DC    A(0)                    +18
00071C  00000000                             132          DC    A(0)                    +1C
ASMA Ver. 0.2.0  fix-page.asm: Test the Fix Page E502 Assist                                        05 Oct 2020 07:42:20  Page     4

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

000720  00000000                             133          DC    A(0)                    +20
000724  00000000                             134          DC    A(0)                    +24
000728  00000000                             135          DC    A(0)                    +28
00072C  00000000                             136          DC    A(0)                    +2C
000730  00000000                             137          DC    A(0)                    +30
000734  0000021E                             138 MPLPFAL  DC    A(SUCCESS)              +34
000738  00000000                             139          DC    A(0)                    +38
                                             140 *
00073C  00002000                             141 PGSTART  DC    X'00002000'             -> begin page to fix
000740  00002000                             142 PGEND    DC    X'00002000'             -> end page to fix
000744  00002044                             143 PGRADD   DC    X'00002044'             -> address within the page to be fixed
                                             144 *
                                             145 *                            0 1 2 3  4 5 6 7
                                             146 *r 300.8
                                             147 *Want "R14-R15 values"      0000021A 0000021E
                                             148 *
                                             149          END
ASMA Ver. 0.2.0  fix-page.asm: Test the Fix Page E502 Assist                                        05 Oct 2020 07:42:20  Page     5

     SYMBOL        TYPE  VALUE   LENGTH  DEFN  REFERENCES

AMPLP               A    0000A4       4    78   99
DWAITPSW            X    000228       8   111  108
EOJ                 U    000222       1   107  102
FAIL                U    00021A       1   101
FPA001              J    000000    1864    42
IMAGE               1    000000    1864     0
MPLP                A    000700       4   125   78
MPLPFAL             A    000734       4   138
PGEND               X    000740       4   142
PGMINTC             F    00008C       4    67
PGMNPSW             X    000068       4    75
PGMOPSW             U    000028       1    69
PGRADD              X    000744       4   143   98
PGSTART             X    00073C       4   141   97
R0                  U    000000       1    44   62   98
R1                  U    000001       1    45   97
R10                 U    00000A       1    54
R11                 U    00000B       1    55
R12                 U    00000C       1    56
R13                 U    00000D       1    57
R14                 U    00000E       1    58   93   95  105
R15                 U    00000F       1    59   94   95  105
R2                  U    000002       1    46   97
R3                  U    000003       1    47
R4                  U    000004       1    48
R5                  U    000005       1    49
R6                  U    000006       1    50
R7                  U    000007       1    51
R8                  U    000008       1    52
R9                  U    000009       1    53
RESULTS             X    000300       4   115   95  105
START               H    000200       2    86   72
STRTLABL            U    000000       1    43   66   69   71   74   77   85  114  119
SUCCESS             U    00021E       1   104  138
ASMA Ver. 0.2.0  fix-page.asm: Test the Fix Page E502 Assist                                        05 Oct 2020 07:42:20  Page     6

MACRO   DEFN  REFERENCES

No defined macros
ASMA Ver. 0.2.0  fix-page.asm: Test the Fix Page E502 Assist                                        05 Oct 2020 07:42:20  Page     7

   DESC    SYMBOL  SIZE    POS      ADDR

Entry: 0

Image      IMAGE   1864  000-747  000-747
  Region           1864  000-747  000-747
    CSECT  FPA001  1864  000-747  000-747
ASMA Ver. 0.2.0  fix-page.asm: Test the Fix Page E502 Assist                                        05 Oct 2020 07:42:20  Page     8

   STMT       FILE NAME

1     D:\satk\fix-page.asm


** NO ERRORS FOUND **

